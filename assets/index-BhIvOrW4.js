(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))y(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const g of s.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&y(g)}).observe(document,{childList:!0,subtree:!0});function a(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerPolicy&&(s.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?s.credentials="include":l.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function y(l){if(l.ep)return;l.ep=!0;const s=a(l);fetch(l.href,s)}})();const F="/gala-clicker/galaStudent.webp",H="/gala-clicker/galaTrainee.webp",B="/gala-clicker/galaJunior.webp",V="/gala-clicker/galaMiddle.webp",K="/gala-clicker/galaSenior.webp",W="/gala-clicker/galaTeamLead.webp",Q="/gala-clicker/galaGoogle.webp",k="http://localhost:8080/api/users/";async function A(r){try{const o=await fetch(`${k}${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return await o.json()}catch(o){return console.error("Error updating user:",o),{error:"Error updating user data"}}}async function Z(r){try{const o=await fetch(`${k}${r}`);if(!o.ok){if(o.status===404)return null;throw new Error(`HTTP error! status: ${o.status}`)}return await o.json()}catch(o){return console.error("Error fetching user:",o),{error:"Error fetching user data"}}}function q(r){console.log("Initializing app with user:",r);const o=document.querySelectorAll("nav ul li a"),a=document.querySelectorAll(".section");o.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const n=t.target.getAttribute("data-section");a.forEach(c=>{c.id===n?c.classList.add("active"):c.classList.remove("active")})})}),document.querySelectorAll("img").forEach(e=>{e.addEventListener("contextmenu",t=>t.preventDefault()),e.setAttribute("draggable","false")});const l=document.querySelector("#circle"),s=document.querySelector("#score"),g=document.querySelector("#daily-score"),D=document.querySelector("#monthly-score"),N=document.querySelector("#progress-fill"),P=document.querySelector("#clicks-left"),R=document.querySelector("#available-lines");let m=localStorage.getItem("availableLines")?Number(localStorage.getItem("availableLines")):100,S=null,I=null;const f=[{id:1,name:"Student",numberOfCodeLines:0,imgUrl:F,xlevel:1,maxLines:100},{id:2,name:"Trainee",numberOfCodeLines:1e4,imgUrl:H,xlevel:1,maxLines:100},{id:3,name:"Junior",numberOfCodeLines:1e5,imgUrl:B,xlevel:5,maxLines:200},{id:4,name:"Middle",numberOfCodeLines:1e6,imgUrl:V,xlevel:10,maxLines:400},{id:5,name:"Senior",numberOfCodeLines:1e7,imgUrl:K,xlevel:15,maxLines:600},{id:6,name:"Team Lead",numberOfCodeLines:1e8,imgUrl:W,xlevel:25,maxLines:800},{id:7,name:"Google",numberOfCodeLines:1e9,imgUrl:Q,xlevel:50,maxLines:999}];function X(e){Y(),G(),b(i()),x($()),w(C()),U(),T(),O(),L(),m<d(i()).maxLines&&(S=setInterval(_,1e3)),j(r)}function b(e){localStorage.setItem("score",e),s.textContent=e}function x(e){localStorage.setItem("dailyScore",e),g.textContent=e}function w(e){localStorage.setItem("monthlyScore",e),D.textContent=e}function i(){return Number(localStorage&&localStorage.getItem("score"))||0}function $(){return Number(localStorage.getItem("dailyScore"))||0}function C(){return Number(localStorage.getItem("monthlyScore"))||0}function Y(){const e=localStorage.getItem("lastUpdated"),t=new Date().toISOString().split("T")[0];e!==t&&(localStorage.setItem("dailyScore",0),localStorage.setItem("lastUpdated",t))}function G(){const e=localStorage.getItem("lastUpdatedMonthly"),t=new Date().toISOString().slice(0,7);e!==t&&(localStorage.setItem("monthlyScore",0),localStorage.setItem("lastUpdatedMonthly",t))}function J(){if(m>0){const e=i(),t=d(e),n=i()+t.xlevel,c=$()+t.xlevel,p=C()+t.xlevel;m-=1,localStorage.setItem("availableLines",m),b(n),x(c),w(p),U(),T(),O(),L();const v={id:localStorage.getItem("userId"),first_name:localStorage.getItem("first_name"),last_name:localStorage.getItem("last_name"),username:localStorage.getItem("username"),score:n,level:t.id,availableLines:m};A(v),clearTimeout(I),clearInterval(S),I=setTimeout(()=>{S=setInterval(_,1e3)},5e3)}else{l.classList.add("grayscale");return}}function U(){const e=i(),t=E(e),n=d(e),c=(e-n.numberOfCodeLines)/(t.numberOfCodeLines-n.numberOfCodeLines)*100;N.style.width=`${c}%`}function O(){const e=i(),t=E(e),n=d(e),c=Math.ceil((t.numberOfCodeLines-e)/n.xlevel);P.textContent=`Lines left level ${t.name}: ${c}`}function T(){const e=i(),t=d(e);l.setAttribute("src",`${t.imgUrl}`)}function L(){const e=i(),t=d(e);R.textContent=`${m} / ${t.maxLines}`}function _(){const e=i(),t=d(e);m<t.maxLines?(m+=1,localStorage.setItem("availableLines",m),L(),m>0&&l.classList.remove("grayscale")):clearInterval(S)}function d(e){return f.slice().reverse().find(t=>e>=t.numberOfCodeLines)||f[0]}function E(e){return f.find(t=>e<t.numberOfCodeLines)||f[f.length-1]}function j(e){const t=document.querySelector(".user__info"),n=i(),c=d(n);t.innerHTML=`
            <p>Total Clicks: ${n}</p>
            <p>Current Level: ${c.name}</p>
            <p>First Name: ${e.first_name}</p>
            <p>Last Name: ${e.last_name}</p>
        `}l.addEventListener("click",e=>{const t=l.getBoundingClientRect(),n=e.clientX-t.left-t.width/2,c=e.clientY-t.top-t.height/2,p=40,v=c/t.height*p,z=n/t.width*-p;l.style.setProperty("--tiltX",`${v}deg`),l.style.setProperty("--tiltY",`${z}deg`),setTimeout(()=>{l.style.setProperty("--tiltX","0deg"),l.style.setProperty("--tiltY","0deg")},200);const u=document.createElement("div");u.classList.add("plusone"),u.textContent=`+${d(i()).xlevel}`,u.style.left=`${e.clientX-t.left}px`,u.style.top=`${e.clientY-t.top}px`,l.parentElement.appendChild(u),J(),setTimeout(()=>{u.remove()},2e3)}),X()}const h=window.Telegram.WebApp,M=h.initDataUnsafe.user;async function ee(r){const o={id:r.id,first_name:r.first_name,last_name:r.last_name,username:r.username,score:0,dailyScore:0,monthlyScore:0,lastUpdated:"",lastUpdatedMonthly:"",level:1,availableLines:100};try{const a=await Z(r.id);a&&!a.error?(localStorage.setItem("score",a.score),localStorage.setItem("dailyScore",a.dailyScore),localStorage.setItem("monthlyScore",a.monthlyScore),localStorage.setItem("level",a.level),localStorage.setItem("first_name",a.first_name),localStorage.setItem("last_name",a.last_name),localStorage.setItem("availableLines",a.availableLines),localStorage.setItem("username",a.username)):(await A(o),localStorage.setItem("score",o.score),localStorage.setItem("dailyScore",o.dailyScore),localStorage.setItem("monthlyScore",o.monthlyScore),localStorage.setItem("level",o.level),localStorage.setItem("first_name",o.first_name),localStorage.setItem("last_name",o.last_name),localStorage.setItem("availableLines",o.availableLines),localStorage.setItem("username",o.username),localStorage.setItem("userId",o.id)),q(r)}catch(a){alert(a)}}M?(ee(M),h.expand(),h.ready()):q();
