(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))g(l);new MutationObserver(l=>{for(const n of l)if(n.type==="childList")for(const f of n.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&g(f)}).observe(document,{childList:!0,subtree:!0});function i(l){const n={};return l.integrity&&(n.integrity=l.integrity),l.referrerPolicy&&(n.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?n.credentials="include":l.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function g(l){if(l.ep)return;l.ep=!0;const n=i(l);fetch(l.href,n)}})();const B="/gala-clicker/galaStudent.webp",V="/gala-clicker/galaTrainee.webp",W="/gala-clicker/galaJunior.webp",H="/gala-clicker/galaMiddle.webp",K="/gala-clicker/galaSenior.webp",Q="/gala-clicker/galaTeamLead.webp",Z="/gala-clicker/galaGoogle.webp",q="http://localhost:8080/api/users/";async function D(r){return(await fetch(`${q}${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})).json()}async function ee(r){return(await fetch(`${q}/users/${r}`)).json()}function M(r){console.log("Initializing app with user:",r);const o=document.querySelectorAll("nav ul li a"),i=document.querySelectorAll(".section");o.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const a=t.target.getAttribute("data-section");i.forEach(s=>{s.id===a?s.classList.add("active"):s.classList.remove("active")})})}),document.querySelectorAll("img").forEach(e=>{e.addEventListener("contextmenu",t=>t.preventDefault()),e.setAttribute("draggable","false")});const l=document.querySelector("#circle"),n=document.querySelector("#score"),f=document.querySelector("#daily-score"),N=document.querySelector("#monthly-score"),P=document.querySelector("#total-score"),R=document.querySelector("#progress-fill"),X=document.querySelector("#clicks-left"),Y=document.querySelector("#available-lines");let m=localStorage.getItem("availableLines")?Number(localStorage.getItem("availableLines")):100,p=null,b=null;const S=[{id:1,name:"Student",numberOfCodeLines:0,imgUrl:B,xlevel:1,maxLines:100},{id:2,name:"Trainee",numberOfCodeLines:1e4,imgUrl:V,xlevel:1,maxLines:100},{id:3,name:"Junior",numberOfCodeLines:1e5,imgUrl:W,xlevel:5,maxLines:200},{id:4,name:"Middle",numberOfCodeLines:1e6,imgUrl:H,xlevel:10,maxLines:400},{id:5,name:"Senior",numberOfCodeLines:1e7,imgUrl:K,xlevel:15,maxLines:600},{id:6,name:"Team Lead",numberOfCodeLines:1e8,imgUrl:Q,xlevel:25,maxLines:800},{id:7,name:"Google",numberOfCodeLines:1e9,imgUrl:Z,xlevel:50,maxLines:999}];function G(e){J(),j(),h(c()),x($()),C(O()),w(T()),_(),k(),U(),v(),m<u(c()).maxLines&&(p=setInterval(A,1e3)),z(r)}function h(e){localStorage.setItem("score",e),n.textContent=e}function x(e){localStorage.setItem("dailyScore",e),f.textContent=e}function C(e){localStorage.setItem("monthlyScore",e),N.textContent=e}function w(e){localStorage.setItem("totalScore",e),P.textContent=e}function c(){return Number(localStorage&&localStorage.getItem("score"))||0}function $(){return Number(localStorage.getItem("dailyScore"))||0}function O(){return Number(localStorage.getItem("monthlyScore"))||0}function T(){return Number(localStorage.getItem("totalScore"))||0}function J(){const e=localStorage.getItem("lastUpdated"),t=new Date().toISOString().split("T")[0];e!==t&&(localStorage.setItem("dailyScore",0),localStorage.setItem("lastUpdated",t))}function j(){const e=localStorage.getItem("lastUpdatedMonthly"),t=new Date().toISOString().slice(0,7);e!==t&&(localStorage.setItem("monthlyScore",0),localStorage.setItem("lastUpdatedMonthly",t))}function F(){if(m>0){const e=c(),t=u(e),a=c()+t.xlevel,s=$()+t.xlevel,L=O()+t.xlevel,y=T()+t.xlevel;m-=1,localStorage.setItem("availableLines",m),h(a),x(s),C(L),w(y),_(),k(),U(),v();const I={id:localStorage.getItem("userId"),first_name:localStorage.getItem("first_name"),last_name:localStorage.getItem("last_name"),username:localStorage.getItem("username"),totalClicks:y,level:t.id,availableLines:m};D(I),clearTimeout(b),clearInterval(p),b=setTimeout(()=>{p=setInterval(A,1e3)},5e3)}else{l.classList.add("grayscale");return}}function _(){const e=c(),t=E(e),a=u(e),s=(e-a.numberOfCodeLines)/(t.numberOfCodeLines-a.numberOfCodeLines)*100;R.style.width=`${s}%`}function U(){const e=c(),t=E(e),a=u(e),s=Math.ceil((t.numberOfCodeLines-e)/a.xlevel);X.textContent=`Lines left level ${t.name}: ${s}`}function k(){const e=c(),t=u(e);l.setAttribute("src",`${t.imgUrl}`)}function v(){const e=c(),t=u(e);Y.textContent=`${m} / ${t.maxLines}`}function A(){const e=c(),t=u(e);m<t.maxLines?(m+=1,localStorage.setItem("availableLines",m),v(),m>0&&l.classList.remove("grayscale")):clearInterval(p)}function u(e){return S.slice().reverse().find(t=>e>=t.numberOfCodeLines)||S[0]}function E(e){return S.find(t=>e<t.numberOfCodeLines)||S[S.length-1]}function z(e){const t=document.querySelector(".user__info"),a=c(),s=u(a);t.innerHTML=`
            <p>Total Clicks: ${a}</p>
            <p>Current Level: ${s.name}</p>
            <p>First Name: ${e.first_name}</p>
            <p>Last Name: ${e.last_name}</p>
        `}l.addEventListener("click",e=>{const t=l.getBoundingClientRect(),a=e.clientX-t.left-t.width/2,s=e.clientY-t.top-t.height/2,L=40,y=s/t.height*L,I=a/t.width*-L;l.style.setProperty("--tiltX",`${y}deg`),l.style.setProperty("--tiltY",`${I}deg`),setTimeout(()=>{l.style.setProperty("--tiltX","0deg"),l.style.setProperty("--tiltY","0deg")},200);const d=document.createElement("div");d.classList.add("plusone"),d.textContent=`+${u(c()).xlevel}`,d.style.left=`${e.clientX-t.left}px`,d.style.top=`${e.clientY-t.top}px`,l.parentElement.appendChild(d),F(),setTimeout(()=>{d.remove()},2e3)}),G()}if(window.Telegram&&window.Telegram.WebApp){const r=window.Telegram.WebApp,o=r.initDataUnsafe.user;o&&ee(o.id).then(i=>{if(i)localStorage.setItem("score",i.totalClicks),localStorage.setItem("level",i.level),localStorage.setItem("availableLines",100),localStorage.setItem("first_name",i.first_name),localStorage.setItem("last_name",i.last_name),localStorage.setItem("username",i.username);else{const g={id:o.id,first_name:o.first_name,last_name:o.last_name,username:o.username,totalClicks:0,level:1,availableLines:100};D(g),localStorage.setItem("userId",o.id),localStorage.setItem("first_name",o.first_name),localStorage.setItem("last_name",o.last_name),localStorage.setItem("username",o.username),localStorage.setItem("score",0),localStorage.setItem("level",1),localStorage.setItem("availableLines",100)}M(o)}),r.expand(),r.ready()}else M();
